////  ComandaRealitzadaViewController.m//  Expresso////  Created by David Cortés Fulla on 08/12/10.//  Copyright 2010 Facultat d'Informatica de Barcelona (UPC). All rights reserved.//#import "ComandaRealitzadaViewController.h"#import "Favorits.h"#import "Extra.h"@implementation ComandaRealitzadaViewController@synthesize producte;@synthesize subproducte;@synthesize extres;@synthesize preu;@synthesize guardarBeguda;// The designated initializer.  Override if you create the controller programmatically and want to perform customization that is not appropriate for viewDidLoad.- (IBAction) guardaBeguda{	NSLog(@"Guarda Fav");	Favorits *favorit = (Favorits *)[NSEntityDescription insertNewObjectForEntityForName:@"Favorits" inManagedObjectContext:[appDelegate managedObjectContext]];		NSNumberFormatter *formater = [[NSNumberFormatter alloc] init];	[formater setNumberStyle:NSNumberFormatterDecimalStyle];		favorit.producte = 	[producte text];	favorit.subproducte = [subproducte text];	favorit.preu = [appDelegate preu];	favorit.tamany = [appDelegate tamany];	favorit.usuari = [appDelegate usuari];		Extra *extra;	for (int i=0; i<[[appDelegate extres] count]; i++) {		extra = (Extra *)[NSEntityDescription insertNewObjectForEntityForName:@"Extra" inManagedObjectContext:[appDelegate managedObjectContext]];		extra.nom = [[[appDelegate extres] allKeys] objectAtIndex:i];		extra.preu = [formater numberFromString:[[appDelegate extres] valueForKey:extra.nom]];		[favorit addExtresObject:extra];	}	NSError *error;		if (![[appDelegate managedObjectContext] save:&error]){		//no se ha podido guardar el resultado. Hacer un aviso al usuario o reiniciar la aplicacion.		NSLog(@"Error %@", error);	}	else{		NSLog(@"Agregada beguda!");	}		[guardarBeguda setAlpha:0.5];	[guardarBeguda setEnabled:NO];}- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];    if (self) {        // Custom initialization.		f = [[NSNumberFormatter alloc] init];		[f setNumberStyle:NSNumberFormatterCurrencyStyle];		[f setCurrencySymbol:@"€ "];    }    return self;}// Implement viewDidLoad to do additional setup after loading the view, typically from a nib.- (void)viewDidLoad {	[super viewDidLoad];		appDelegate = (ExpressoAppDelegate*)[[UIApplication sharedApplication] delegate];	//Si venim de favorit			NSLog(@"Producte: %@", [appDelegate producte]);				producteDictionary = [[[[appDelegate carta] valueForKey:@"carta"] valueForKey:@"productes"]							  objectAtIndex:[[appDelegate producte] unsignedIntValue]];				[producte setText:[producteDictionary valueForKey:@"nom"]];				[subproducte setText:[[[producteDictionary valueForKey:@"subproductes"] 							   objectAtIndex:[[appDelegate subproducte] unsignedIntValue]] valueForKey:@"nom"]];				[extres setText:[[[appDelegate extres] allKeys] componentsJoinedByString:@", "]];							[preu setText:[f stringFromNumber:[appDelegate preu]]];		}/*// Override to allow orientations other than the default portrait orientation.- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {    // Return YES for supported orientations.    return (interfaceOrientation == UIInterfaceOrientationPortrait);}*/- (void)didReceiveMemoryWarning {    // Releases the view if it doesn't have a superview.    [super didReceiveMemoryWarning];        // Release any cached data, images, etc. that aren't in use.}- (void)viewDidUnload {    [super viewDidUnload];    // Release any retained subviews of the main view.    // e.g. self.myOutlet = nil;}- (void)dealloc {    [super dealloc];}@end